<!DOCTYPE html>
<html lang="en" data-theme="midnight">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anteroom</title>
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNSIgZmlsbD0iIzBmMTExNSIgc3Ryb2tlPSIjQzVBMDU5IiBzdHJva2Utd2lkdGg9IjEuNSIvPjxsaW5lIHgxPSIxNiIgeTE9IjQiIHgyPSIxNiIgeTI9IjI4IiBzdHJva2U9IiNDNUEwNTkiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMC42Ii8+PGxpbmUgeDE9IjQiIHkxPSIxNiIgeDI9IjI4IiB5Mj0iMTYiIHN0cm9rZT0iI0M1QTA1OSIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIwLjYiLz48bGluZSB4MT0iNy41IiB5MT0iNy41IiB4Mj0iMjQuNSIgeTI9IjI0LjUiIHN0cm9rZT0iI0M1QTA1OSIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIwLjQiLz48bGluZSB4MT0iMjQuNSIgeTE9IjcuNSIgeDI9IjcuNSIgeTI9IjI0LjUiIHN0cm9rZT0iI0M1QTA1OSIgc3Ryb2tlLXdpZHRoPSIxIiBvcGFjaXR5PSIwLjQiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNDNUEwNTkiIHN0cm9rZS13aWR0aD0iMS41Ii8+PGNpcmNsZSBjeD0iMTYiIGN5PSI0IiByPSIxLjUiIGZpbGw9IiMzQjgyRjYiLz48Y2lyY2xlIGN4PSIyOCIgY3k9IjE2IiByPSIxLjUiIGZpbGw9IiMzQjgyRjYiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjI4IiByPSIxLjUiIGZpbGw9IiMzQjgyRjYiLz48Y2lyY2xlIGN4PSI0IiBjeT0iMTYiIHI9IjEuNSIgZmlsbD0iIzNCODJGNiIvPjwvc3ZnPg==">
    <script src="/js/theme_bootstrap.js"></script>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/approvals.css">
    <link rel="stylesheet" href="/vendor/highlight-github-dark.min.css">
    <link rel="stylesheet" href="/vendor/katex.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand" style="text-align:center;padding:4px 0 8px;font-family:'Cinzel',Georgia,serif;font-size:16px;font-weight:700;letter-spacing:0.15em;color:var(--accent)">ANTEROOM</div>
                <button class="btn-new-chat" id="btn-new-chat" title="New conversation (Ctrl+Shift+N)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/><line x1="12" y1="8" x2="12" y2="14"/><line x1="9" y1="11" x2="15" y2="11"/></svg>
                    New Chat
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="search-input" placeholder="Search conversations..." autocomplete="off">
            </div>
            <div class="sidebar-databases" id="sidebar-databases">
                <div class="sidebar-section-header">
                    <span class="sidebar-section-label">Databases</span>
                    <button class="btn-section-action" id="btn-db-add" title="Add database">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        <span>Add</span>
                    </button>
                </div>
                <div class="db-list" id="db-list">
                    <!-- Database items populated by JS -->
                </div>
            </div>
            <div class="sidebar-projects" id="sidebar-projects">
                <div class="sidebar-section-header">
                    <span class="sidebar-section-label">Projects</span>
                    <button class="btn-section-action" id="btn-project-add" title="Create new project">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        <span>New</span>
                    </button>
                </div>
                <div class="project-list" id="project-list">
                    <!-- Project items populated by JS -->
                </div>
                <div class="project-active-bar" id="project-active-bar" style="display:none">
                    <div class="project-active-info">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
                        <span class="project-active-name" id="project-active-name"></span>
                    </div>
                    <div class="project-active-actions">
                        <button class="btn-project-action" id="btn-project-edit" title="Edit project">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                        </button>
                        <button class="btn-project-action btn-project-action-danger" id="btn-project-delete" title="Delete project">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                            </svg>
                        </button>
                        <button class="btn-project-action" id="btn-project-clear" title="Show all conversations">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                </div>
                <!-- Hidden select for data binding -->
                <select id="project-select" style="display:none">
                    <option value="">All Conversations</option>
                </select>
            </div>
            <div class="sidebar-section-header" style="padding-top:4px">
                <span class="sidebar-section-label">Conversations</span>
                <button class="btn-section-action" id="btn-folder-add" title="Create folder">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>
                    <span>Folder</span>
                </button>
            </div>
            <div class="conversation-list" id="conversation-list">
                <!-- Conversation items populated by JS -->
            </div>
            <div class="sidebar-footer" id="sidebar-footer">
                <button class="btn-settings" id="btn-settings" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
                    </svg>
                    <span>Settings</span>
                </button>
                <span class="mcp-status" id="mcp-status"></span>
            </div>
        </aside>

        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settings-modal" style="display:none">
            <div class="modal">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="modal-close" id="settings-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label>Theme</label>
                        <div class="theme-picker" id="theme-picker">
                            <!-- Theme cards populated by JS -->
                        </div>
                    </div>
                    <div class="setting-group">
                        <label for="setting-model">Model</label>
                        <select id="setting-model">
                            <option value="">Loading models...</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="setting-system-prompt">System Prompt</label>
                        <textarea id="setting-system-prompt" rows="5" placeholder="You are a helpful assistant."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-modal-cancel" id="settings-cancel">Cancel</button>
                    <button class="btn-modal-save" id="settings-save">Save</button>
                </div>
            </div>
        </div>

        <!-- Project Modal -->
        <div class="modal-overlay" id="project-modal" style="display:none">
            <div class="modal">
                <div class="modal-header">
                    <h3 id="project-modal-title">New Project</h3>
                    <button class="modal-close" id="project-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label for="project-name">Name</label>
                        <input type="text" id="project-name" placeholder="Project name" autocomplete="off">
                    </div>
                    <div class="setting-group">
                        <label for="project-instructions">Instructions</label>
                        <textarea id="project-instructions" rows="6" placeholder="Custom system prompt for this project..."></textarea>
                        <span class="setting-hint">These instructions are prepended to the global system prompt for all conversations in this project.</span>
                    </div>
                    <div class="setting-group">
                        <label for="project-model">Model (optional)</label>
                        <select id="project-model">
                            <option value="">Use global default</option>
                        </select>
                        <span class="setting-hint">Override the default model for conversations in this project.</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-modal-cancel" id="project-cancel">Cancel</button>
                    <button class="btn-modal-save" id="project-save">Save</button>
                </div>
            </div>
        </div>

        <!-- Add Database Modal -->
        <div class="modal-overlay" id="db-modal" style="display:none">
            <div class="modal" style="width:600px">
                <div class="modal-header">
                    <h3>Add Database</h3>
                    <button class="modal-close" id="db-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label for="db-name-input">Database Name</label>
                        <input type="text" id="db-name-input" placeholder="my-database" autocomplete="off">
                        <span class="setting-hint">Letters, numbers, hyphens, underscores only.</span>
                    </div>
                    <div class="setting-group">
                        <label for="db-path-input">Database Path</label>
                        <div class="browse-path-row">
                            <input type="text" id="db-path-input" placeholder="/path/to/database.db" autocomplete="off">
                            <button class="btn-browse" id="btn-browse">Browse</button>
                        </div>
                        <span class="setting-hint">File will be created if it doesn't exist.</span>
                    </div>
                    <div class="browse-panel" id="browse-panel" style="display:none">
                        <div class="browse-current" id="browse-current"></div>
                        <div class="browse-entries" id="browse-entries"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-modal-cancel" id="db-modal-cancel">Cancel</button>
                    <button class="btn-modal-save" id="db-modal-save">Add</button>
                </div>
            </div>
        </div>

        <!-- Command Palette -->
        <div class="palette-overlay" id="palette-overlay" style="display:none">
            <div class="palette-modal">
                <input type="text" class="palette-input" id="palette-input" placeholder="Type to search..." autocomplete="off">
                <div class="palette-results" id="palette-results">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Rewind Modal -->
        <div class="modal-overlay" id="rewind-modal" style="display:none">
            <div class="modal">
                <div class="modal-header">
                    <h3>Rewind Conversation</h3>
                    <button class="modal-close" id="rewind-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Go back to this point in the conversation?</p>
                </div>
                <div class="modal-footer">
                    <button id="rewind-undo-files" class="btn-modal-save">Rewind &amp; undo file changes</button>
                    <button id="rewind-keep-files" class="btn-modal-cancel">Rewind conversation only</button>
                </div>
            </div>
        </div>

        <!-- MCP Server Modal -->
        <div class="modal-overlay" id="mcp-modal" style="display:none">
            <div class="modal" style="width:600px">
                <div class="modal-header">
                    <h3>MCP Servers</h3>
                    <button class="modal-close" id="mcp-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="mcp-server-list">
                        <!-- Server rows populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <main class="chat-main">
            <!-- Model selector topbar -->
            <div class="chat-topbar" id="chat-topbar">
                <button class="mobile-menu-btn" id="mobile-menu-btn" title="Toggle sidebar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                </button>
                <div class="model-selector" id="model-selector">
                    <button class="model-selector-btn" id="model-selector-btn" type="button">
                        <span class="model-selector-label" id="model-selector-label">Default model</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="model-selector-dropdown" id="model-selector-dropdown">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Setup banner (hidden by default) -->
            <div class="setup-banner" id="setup-banner" style="display:none">
                <p>AI service not configured. Please set up your <code>~/.anteroom/config.yaml</code>.</p>
            </div>

            <!-- Offline banner (hidden by default) -->
            <div class="offline-banner" id="offline-banner" style="display:none">
                <span>You are offline. Reconnecting when network is available...</span>
            </div>

            <!-- Messages container -->
            <div class="messages-container" id="messages-container">
                <div class="welcome-message" id="welcome-message">
                    <h2>Welcome to the Anteroom</h2>
                    <p>Your connection is secure. How may I assist you today?</p>
                    <div class="welcome-tips">
                        <p>Tips:</p>
                        <ul>
                            <li><strong>Enter</strong> to send, <strong>Shift+Enter</strong> for new line</li>
                            <li><strong>Ctrl+Shift+N</strong> for new conversation</li>
                            <li><strong>Cmd/Ctrl+K</strong> for command palette</li>
                            <li><strong>Escape</strong> to stop AI response</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Input area -->
            <div class="input-area" id="input-area">
                <div class="attachment-previews" id="attachment-previews">
                    <!-- File previews shown here before sending -->
                </div>
                <div class="input-row">
                    <button class="btn-attach" id="btn-attach" title="Attach file">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/>
                        </svg>
                    </button>
                    <textarea id="message-input" placeholder="Type a message..." rows="1" autofocus></textarea>
                    <button class="btn-send" id="btn-send" title="Send message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                    </button>
                    <button class="btn-stop" id="btn-stop" title="Stop generating (Escape)" style="display:none">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12" rx="2"/>
                        </svg>
                    </button>
                </div>
            </div>
            <input type="file" id="file-input" multiple style="display:none">
        </main>
    </div>

    <script src="/vendor/purify.min.js" integrity="sha384-eEu5CTj3qGvu9PdJuS+YlkNi7d2XxQROAFYOr59zgObtlcux1ae1Il3u7jvdCSWu" crossorigin="anonymous"></script>
    <script src="/vendor/marked.min.js" integrity="sha384-H+hy9ULve6xfxRkWIh/YOtvDdpXgV2fmAGQkIDTxIgZwNoaoBal14Di2YTMR6MzR" crossorigin="anonymous"></script>
    <script src="/vendor/highlight.min.js" integrity="sha384-F/bZzf7p3Joyp5psL90p/p89AZJsndkSoGwRpXcZhleCWhd8SnRuoYo4d0yirjJp" crossorigin="anonymous"></script>
    <script src="/vendor/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script>
    <script src="/vendor/katex-auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script>
    <script src="/js/app.js"></script>
    <script src="/js/approvals.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/sidebar.js"></script>
    <script src="/js/palette.js"></script>
    <script src="/js/attachments.js"></script>
</body>
</html>
